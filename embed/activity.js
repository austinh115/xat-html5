function activityMain(){var e=activityToC("xatInit","","");console.log("Done xatInit"),setPage(ClassicGroup?"classic":0==e?"profile":"chats");activityToC("setContacts","",""),activityToC("xatMain","",""),console.log("Done xatMain"),activityToC("leaveBackground","","");var o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,a=12;o<=320||t<=320?a=32:o<=640||t<=640?a=21:o<=786||t<=786?a=17:(o>=1024||t>=1024)&&(a=14),ConsoleOff=activityToC("ConsoleOff","","")>0,activityToC("SetPhoneFontSize","",a.toString()),activityToC("setLang","",window.navigator.userLanguage||window.navigator.language),ClassicGroup&&activityToC("xatCommand","",JSON.stringify({Command:"StartGroup",Group:ClassicGroup})),setInterval(function(){TimerMethod()},100),activityToC("xatCommand","",JSON.stringify({Command:"EnableTick"}))}function setPage(e){var o;if(e&&("pop"==e&&"classic"==Page&&(o=!0,e=Page),e=activityToC("SetPage","",e),o||e!=Page))switch(Page=e,"profile"==e&&(e="actions"),activityToC("viewWillDisappear","",""),e){case"captcha":var t=JSON.stringify(PageJson);(a=document.getElementById("appframe")).src=https+"//xat.com/web_gear/chat/AreYouaHuman.php?m=3&j="+t;break;case"help":break;case"classic":default:var a=document.getElementById("appframe");a.onload=function(e){appframeLoaded=!0,activityToC("webViewDidFinishLoad","","")},a.src="www/"+e+".html"}}function DoPageClick(e){if("string"==typeof e&&(e=decodeURIComponent((e+"").replace(/\+/g,"%20")),e=JSON.parse(e)),"xtrace"!=(PageJson=e).Type){if(!PageJson.Page)return void console.log("!!** No Page **!! ");var o=PageJson.LastActionHero;o||(o="");var t=PageJson.SavedId;t||(t=""),LastActionHero==o&&SavedId==t||activityToC("LastActionHero",LastActionHero=o,SavedId=t);var a=PageJson.Next;switch(PageJson.Command){case"":case"NOP":case"HitWeb":break;case"Action":switch(PageJson.name){case"BuyXats":case"MakePurchase":return}default:activityToC("xatCommand","",JSON.stringify(PageJson))}ClassicGroup&&"captcha"!=a&&"pop"!=a||setPage(a)}}function base64ArrayBuffer(e){for(var o,t,a,n,c="",s=new Uint8Array(e),i=s.byteLength,r=i%3,l=i-r,g=0;g<l;g+=3)o=(258048&(n=s[g]<<16|s[g+1]<<8|s[g+2]))>>12,t=(4032&n)>>6,a=63&n,c+=encodings[(16515072&n)>>18]+encodings[o]+encodings[t]+encodings[a];return 1==r?(o=(3&(n=s[l]))<<4,c+=encodings[(252&n)>>2]+encodings[o]+"=="):2==r&&(o=(1008&(n=s[l]<<8|s[l+1]))>>4,t=(15&n)<<2,c+=encodings[(64512&n)>>10]+encodings[o]+encodings[t]+"="),c}function toUTF8ArrayBuf(e){for(var o=[],t=0;t<e.length;t++){var a=e.charCodeAt(t);a<128?o.push(a):a<2048?o.push(192|a>>6,128|63&a):a<55296||a>=57344?o.push(224|a>>12,128|a>>6&63,128|63&a):(t++,a=65536+((1023&a)<<10|1023&e.charCodeAt(t)),o.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|63&a))}for(var n=o.length,c=new ArrayBuffer(n),s=new Uint8Array(c),t=0;t<n;t++)s[t]=o[t];return c}function xatSend(e,o){if(console.log("xatSend="+e+","+o),websocket){var t=toUTF8ArrayBuf(o);websocket.send(t)}}function xatClose(){isOpen=!1,console.log("xatClose"),websocket&&(xatSend(0,"<C />"),websocket.close(),websocket=null)}function DoNotify(e,o){switch(e){case"FifoNotification":if(!appframeLoaded)return;var t=JSON.parse(o);trace(t);for(var a,n=document.getElementById("appframe").contentWindow,c=0;c<t.length;c++)if("{"==t[c].charAt(0))switch((a=JSON.parse(t[c])).Command){case"ToSideapp":parent.toDirect&&parent.toDirect(a);break;case"setCount":setCount&&setCount(a.setCount)}else try{n.eval(t[c].toString())}catch(e){console.log("FIFO ERR "+e+" "+t[c].toString())}return;case"SetGroupsPage":return void setPage("groups");case"SetChatsPage":return void setPage("chats");case"SetMePage":return void setPage("profile");case"SetBackPage":return void setPage("pop");case"SetVisitors":return void(n=document.getElementById("appframe").contentWindow).openList(0,"visitors",0);default:console.log("!!** DoNotify TODO **!!/"+e+"/")}}function DoAlert(e){alert(e)}function DoLangs(e,o){}function FromC(e,o,t){switch(xInt(e)){case SAVESOL:if("undefined"==typeof Storage)break;localStorage.setItem(o,t);break;case LOADSOL:if("undefined"==typeof Storage)break;localStorage.getItem(o),localStorage.setItem(o,t);break;case LOG:console.log(t);break;case LOADURL:console.log("LOADURL,"+o+","+t);var a=new XMLHttpRequest,n=o;a.onreadystatechange=function(){4===a.readyState&&(200===a.status?activityToC("xatURL",a.responseURL,a.responseText):console.log("LOADURL Err:"+a.status))},t?(a.open("POST",n,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send("json="+t)):(a.open("GET",n,!0),a.send());break;case SEND:console.log("SEND,"+o+","+t),xatSend(o,t);break;case CLOSE:console.log("CLOSE,"+o+","+t),xatClose();break;case CONNECT:t<1e4?(t=xInt(t)+1e4,o="ws://ws.xatech.com"):(o="wss://wss.xatbox.com",t=443),console.log("CONNECT,"+o+","+t),xatClose(),ConnectIp=o,ConnectPort=xInt(t)+"/v2",(websocket=new WebSocket(ConnectIp+":"+ConnectPort)).binaryType="arraybuffer",websocket.onopen=function(e){isOpen=!0,activityToC("xatMessageReceived","#CONNECT_OK","")},websocket.onclose=function(e){activityToC("xatMessageReceived","#CONNECT_CLOSE",""),isOpen=!1},websocket.onmessage=function(e){activityToC("xatMessageReceived","#MESSAGE",base64ArrayBuffer(e.data))},websocket.onerror=function(e){console.log("WebSocket ERROR= "+e.data)};break;case NOTIFY:console.log("NOTIFY,"+o),DoNotify(o,t);break;case ALERT:DoAlert(o);break;case HTTP:https="http:";break;case LANGS:DoLangs(o,t)}}function TimerMethod(){for(var e=activityToC("xatTick","","");;){if(!e)break;var o=JSON.parse(e);o&&FromC(o.Type,o.Cmd,o.Data),e=activityToC("ReadToJavaFifo","","")}}function xLog(e){console.log(e)}function onBackPressed(){console.log("onBackPressed"),setPage("pop")}function xInt(e){return e=parseInt(e),isNaN(e)?0:e}function activityToC(e,o,t){"xatTick"!=e&&"ReadToJavaFifo"!=e&&console.log("activityToC "+e+" "+o+" "+t);var a=2*(2*e.length+1),n=Module._malloc(a);Module.stringToUTF8(e,n,a);var c=2*(2*o.length+1),s=Module._malloc(c);Module.stringToUTF8(o,s,c);var i=2*(2*t.length+1),r=Module._malloc(i);Module.stringToUTF8(t,r,i);var l=Module.ccall("cToC",null,["number","number","number"],[n,s,r]),g=Pointer_stringify(l);return Module._free(l),g}var Page="",LastActionHero="",SavedId="",https="https:",PageJson,websocket,appframeLoaded,ConsoleOff=!1,encodings="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",LOADURL=1,SEND=2,CLOSE=3,CONNECT=4,NOTIFY=5,ALERT=6,HTTP=7,LANGS=8,FINISHTRANSACTION=9,LOG=10,SAVESOL=11,LOADSOL=12,ConnectIp,ConnectPort,isOpen=!1;console.log=function(e,o){return function(o){if(!ConsoleOff){arguments.length>1&&(o=Array.prototype.slice.call(arguments).join(" ")),e(o);var t={ToSideapp:1,channel:0,user:0,msg:o};parent.toDirect&&parent.toDirect(t)}}}(console.log.bind(console),document.getElementById("output")),trace=console.error=console.debug=console.info=console.log,this.activityToC=activityToC;