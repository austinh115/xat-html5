function KillKiss(){kissO&&(kissO.js&&delete kissO.js,kissO.div&&kissO.div.parentElement.removeChild(kissO.div),kissO=void 0)}function DoKiss1(e,t){KillKiss(),(kissO={}).kiss=e,kissO.m=t,kissO.js=loadJs("ks",e,function(){DoKiss2(e)})}function DoKiss2(e){function t(){v.SoundsLoading||(u.update(),(i--<0||v.AnimMc.timeline.duration-1==v.AnimMc.timeline.position)&&(createjs.Ticker.removeEventListener("tick",t),KillKiss()))}var s=document.getElementById("titleBar"),i=360;if(e!=kissO.kiss||!s)return void KillKiss();var a,n,o,r=kissO.div=makeElement(s,"div"),l=makeElement(r,"canvas"),d=window.innerWidth,c=window.innerHeight;d/c>640/480?(o=0,n=(d-640*(a=c/480))/2):(n=0,o=(c-480*(a=d/640))/2);var g=xInt(480*a),m=xInt(640*a),h={};r.style.cssText="position: absolute;",r.style.zIndex="1000",r.style.left=n+"px",r.style.top=o+"px",l.style.cssText="position: absolute; display: block;",l.width=m,l.height=g,l.style.width=m+"px",l.style.height=g+"px";var v=r.exportRoot=new window["ks"+e][e];h.Message=kissO.m,h.Vol=50,v.Args=h;var u=new createjs.Stage(l);u.scaleX=a,u.scaleY=a,u.addChild(v),u.update(),createjs.Ticker.setFPS(12),createjs.Ticker.addEventListener("tick",t);var p=findSymbol(v,"mbox");p&&createTextNoWrap(p,0,0,0,0,h.Message,v.TextCol,0,100,0,18,"center",2)}function findSymbol(e,t){for(var s,i,a=e.getNumChildren(),n=0;n<a;n++){if((s=e.getChildAt(n))[t])return s[t];if(s instanceof createjs.Container&&(i=findSymbol(s,t)))return i}return null}function Html5Strip(e){var t={Command:"SmCacheRead",smer:e};ToCqS.push(t)}function Html5Strip2(e,t,s){if(t)return imgh[e].src=t,void(imgh[e].pRatio=s);var i=imgh[e].sm.split("(")[1].split(")")[0].substr(1).toLowerCase(),a="sm"+i;imgh[a]||(imgh[a]={loaded:0,smers:{}},imgh[a].js=loadJs("sm",i,function(){jsLoaded(a)})),imgh[a].smers[e]=!0,imgh[a].loaded&&jsLoaded(a)}function jsLoaded(e){imgh[e].loaded=1;for(var t in imgh[e].smers)h5Strip(t)}function setCanvas(e,t){var s=e.exportRoot.Frames,i=e.exportRoot.MaxW;if(!Fac72[s]){for(var a in Fac72)if(a>s){s=a;break}s>72&&(s=72),s||(s=1)}(i=i+1&65534)>50&&(i=50),i<20&&(i=20);var n=0;n=(50-i)/2;var o=i;return t>1&&(o=xInt(o*t),n*=t),{Frames:s,pRatio:t,Offset:n,StripHeight:o}}function h5Strip(e){function t(){if(r.stage.update(),0==r.frame){var n=setCanvas(r,l);s=n.StripHeight,i=n.Offset,a=n.Frames,imgh[e].pRatio=n.pRatio,r.bmpcanvas=document.createElement("canvas"),r.bmpcanvas.width=s*a,r.bmpcanvas.height=s}var o=r.canvas.getContext("2d").getImageData(i,i,s,s);o.data;if(r.bmpcanvas.getContext("2d").putImageData(o,r.frame*s,0),++r.frame==a){var d=r.bmpcanvas.toDataURL("image/png");imgh[e].src=d,createjs.Ticker.removeEventListener("tick",t),delete r;var c={Command:"SmCacheStore",smer:e,src:d};return imgh[e].pRatio>1&&(c.pRatio=imgh[e].pRatio.toString()),void ToCqS.push(c)}}var s,i,a,n=imgh[e].sm.split("(")[1].split(")")[0].substr(1).toLowerCase(),o="sm"+n,r=document.createElement("span");r.style.display="block",r.style.width="20px",r.style.height="20px",r.style.position="absolute",r.canvas=document.createElement("canvas"),r.canvas.style.position="absolute",r.canvas.style.display="inline-block",r.appendChild(r.canvas),r.dom_overlay_container=document.createElement("div"),r.dom_overlay_container.style.pointerEvents="none",r.dom_overlay_container.style.overflow="hidden",r.dom_overlay_container.style.position="relative",r.dom_overlay_container.style.display="inline-block",r.appendChild(r.dom_overlay_container),r.exportRoot=new window[o][n],r.stage=new createjs.Stage(r.canvas),r.stage.addChild(r.exportRoot),r.frame=0;var l=1,d=50;window.devicePixelRatio>1&&(d*=l=1.5),r.canvas.width=d,r.canvas.height=d,r.canvas.style.width=r.dom_overlay_container.style.width=d+"px",r.canvas.style.height=r.dom_overlay_container.style.height=d+"px",r.stage.scaleX=l,r.stage.scaleY=l,fnStartAnimation=function(){createjs.Ticker.setFPS(10*window[o].properties.fps),createjs.Ticker.addEventListener("tick",t)},fnStartAnimation()}function loadJs(e,t,s){var i=config.https+"//mt.xat.com/images/js/"+e+"/"+t+".js?z22";console.log("loadJs "+i);var a=document.createElement("script");a.setAttribute("src",i),a.setAttribute("type","text/javascript");var n=!1,o=function(){n||(n=!0,s())};return a.onload=o,a.onreadystatechange=o,document.getElementsByTagName("head")[0].appendChild(a)}function KissInit(e){e.doneInit||(e.Args=e.Args,e.Info={},e.Info.sWidth=640,e.Info.sHeight=480,e.visible=!1,e.playing=!0,e.SndOff=!1,e.LocalInit(),e.doneInit=!0,createjs.Sound.volume=xInt(e.Args.Vol)/100,void 0!=e.Args.WW&&(e.scaleX=e.Args.WW/e.Info.sWidth),void 0!=e.Args.HH&&(e.scaleY=e.Args.HH/e.Info.sHeight),e.LocalGo(),e.MsgBits=e.Args.Message.split("#"),e.Args.Message=e.MsgBits[0],e.visible=!0)}function HugAv(e,t,s){if(e){var i=makeElement(hug0.div,"div");return i.style.cssText="position:absolute; display: block; pointer-events:none;",LoadImage(i,t,"avatar",30,s),i.x=i.y=-15,i}}function DoHug1(e,t,s){e.className="hug",e.style.display="block",e.style.height="70px";var i=makeElement(e,"div");hug0&&hug0.js&&delete hug0.js,(hug0={}).Args=s,hug0.div=i,hug0.hug=t;window.innerWidth;return hug0.Scale=1,hug0.Height=xInt(70*hug0.Scale),hug0.js=loadJs("hg",t,function(){DoHug2()}),hug0}function DoHug2(){function e(){d.SoundsLoading||(c.update(),t--<0&&d.timeline.duration-1==d.timeline.position&&createjs.Ticker.removeEventListener("tick",e),h&&(h.style.left=d.avahold1.x-15+"px",h.style.top=d.avahold1.y-15+"px"),g&&(g.style.left=d.avahold2.x-15+"px",g.style.top=d.avahold2.y-15+"px"))}var t=360,s=hug0.hug,i=hug0.div,a=makeElement(i,"canvas"),n=hug0.Scale,o=(window.innerWidth-750*n)/2;hug0.Args.XO=-o;var r=xInt(70*n),l=xInt(750*n);i.style.cssText="position: absolute;",i.style.left=o+"px",a.width=l,a.height=r,a.style.width=l+"px",a.style.height=r+"px";var d=i.exportRoot=new window["hg"+s][s];d.Args=hug0.Args;var c=new createjs.Stage(a);c.scaleX=n,c.scaleY=n,c.addChild(d),c.update(),createjs.Ticker.setFPS(12),createjs.Ticker.addEventListener("tick",e);var g,m=d.Args.Obj,h=HugAv(d.Info.av,m.image,m),v=ProcessName(m.name,m.status,65535),u=makeElement(hug0.div,"div");u.className="messagesName";f=createSmText(v.name);u.appendChild(f);var p=-o;p<0&&(p=0),u.style.cssText="font-weight: 500; position:absolute; display: block; pointer-events:none; left:"+(d.Info.namex+p+20)+"px; top:"+d.Info.namey+"px",v=ProcessName(m.name,m.status,65535),(u=makeElement(hug0.div,"div")).className="messagesName";var f=createSmText("Fred (d)");u.appendChild(f),u.style.cssText="font-weight: 500; position:absolute; display: block; pointer-events:none; left:"+(d.Info.namex2-p-20-f.offsetWidth)+"px; top:"+d.Info.namey2+"px"}function HugInit(e){e.doneInit||(e.Args=e.Args,e.Info={},e.Info.sWidth=750,e.Info.sHeight=70,e.visible=!1,e.playing=!0,e.SndOff=!1,e.LocalInit(),e.doneInit=!0,HugGo(e))}function HugGo(e){createjs.Sound.volume=xInt(e.Args.Vol)/100,void 0!=e.Args.WW&&(e.scaleX=e.Args.WW/e.Info.sWidth),void 0!=e.Args.HH&&(e.scaleY=e.Args.HH/e.Info.sHeight),e.LocalGo(),e.MsgBits=e.Args.Message.split("#"),e.Args.Message=e.MsgBits[0],HugSetup(e),e.visible=!0,HugKissDebug&&DebugGo(e)}function HugSetup(e){if(t=e.message){(s=DecodeColor(e.MsgBits[1]))||(s=0);i=0;createTextNoWrap(t,0,-4,750,36,e.Args.Message,s,i,100,0,18,"center",2)}(t=e.name)&&(t.shape.visible=!1,e.Info.namex=t.x,e.Info.namey=t.y-t.regY-2),(t=e.name2)&&(t.shape.visible=!1,e.Info.namex2=t.x,e.Info.namey2=t.y-t.regY-2),(t=e.avahold1)&&(t.ava1.visible=!1,e.Info.av=t),(t=e.avahold2)&&(t.ava2.visible=!1,e.Info.av2=t);var t,s=0,i=0;if(t=e.timehold){var a=t.width,n=t.height;e.Args.Time&&createTextNoWrap(t,-a/2,-n/2,a,n,e.Args.Time,s,i,100,0,18,"center",2)}if(t=e.percenthold){var a=t.width,n=t.height;e.Args.Percent&&createTextNoWrap(t,-a/2,-n/2,a,n,e.Args.Percent,s,i,100,0,18,"center",2)}}function createTextNoWrap(e,t,s,i,a,n,o,r,l,d,c,g,m){var h=0,v=999999;window.devicePixelRatio;o=xInt(o);var u=e.shape;u&&(h=2*u.x*e.scaleX,v=2*u.y*e.scaleY,u.visible=!1),4&m&&(h=i,v=a);var p=new createjs.Text(n,"1px","#"+toHex6(o));p.lineWidth=h;for(var f,y,x=10;x>0;x--){if(y=xInt(2*c).toString(),p.font=y+"px Arial",(f=p.getBounds()).width>h)y=Math.sqrt(h/f.width);else{if(f.height<=v)break;y=Math.sqrt(v/f.height)}y>.8&&(y=.8),c*=y}4&m&&(p.x=t,p.y=s),"center"==g&&(p.textAlign=g,p.x=h/2/e.scaleX),e.addChild(p)}function RegisterSounds(e,t){var s,i=[];console.log("RegisterSounds:"+e.join(" "));var a=ManifestQueue=new createjs.LoadQueue;a.installPlugin(createjs.Sound),a.addEventListener("complete",t);for(var n in e){var o=("mp3"==(s=e[n].split("."))[1]?"sounds/":"images/")+e[n];HugKissDebug||(o="https://mt.xat.com/images/js/"+o+"?z6"),i.push({id:s[0],src:o})}a.loadManifest(i)}function PlaySound(e,t,s){e.SndOff||(console.log("PlaySound",t),createjs.Sound.play(t))}function playSound(e,t,s){}var zzs="a,backoff,beye,biggrin,blk,bye,cd,clap,classic,cool,crazy,cry2,dead,d,eek,emo,eyes,frown,fs,g1,goth,hello,hmm,hug,inlove,kiss,mad,ninja,nme,nod,nrd,omg,ono,o_o,pce,pirate2,pty,puke,punk,redface,rofl,rolleyes,rolling,roll,sad,scn,shh,shock,sleep,smile,smirk2,smirk,sry,swt,think,tongue,un,vampire,wary,what,wink,wt,xd,xp,yawn,yum",zzsl=(zzs=zzs.split(",")).length,kissO,hug0,ManifestQueue;