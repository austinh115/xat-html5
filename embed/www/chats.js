var chats=new function(){function e(){addTitleBar(["mob1.chats","Chats"],"🔍",a,d?["mob1.done","Done"]:["mob1.edit","Edit"],t)}function t(){d=!d,Obj={Command:"EditChange"},Obj.OnOff=d?"On":"Off",ToC(Obj),e()}function a(){Obj={Command:"GoSearch",Next:"groups"},ToC(Obj)}function n(e){var t=document.getElementById(e);null!=t&&t.parentNode.removeChild(t)}function i(e,t){var a={ChatId:t[0],Page:"chats",Command:"Favourite"};a.a=t[1],a.g=t[2],a.d=t[3];var n=e.target;e.stopPropagation();var i="1";n.src.search("svg/notfavorite.svg")>=0?n.src="svg/favorite.svg":(n.src="svg/notfavorite.svg",i="0"),n.parentNode.setAttribute("data-Fav",i),ToC(a)}var l="0",o=document.getElementById("ScrollContainer"),d=!1;this.main=function(t){xatMain(t),e(),AddHammer(document.body,Hammer.DIRECTION_LEFT),document.body.style.display="block",o.style.top=document.getElementById("titleBar").clientHeight,o.style.bottom=0,o.addEventListener("scroll",onScrollEventHandler,!1),doZap(10),LoadLang({mob1:0})},this.sendApp=function(e,t,a){if(e.stopPropagation(),null!==t&&"object"==typeof t){var n=xInt(t.id);switch(t.Type){case"swipeleft":t=t.id,n||(t="0");break;case"swiperight":if(!(a=t.id)||!n)return;t=0;break;default:return}}var i={ChatId:t,Page:"chats",Command:"Click",Next:"messages"};a&&(i.DeleteId=a,i.Next=""),ToC(i)},this.SetEdit=function(e){l=e;var t,a,n="1"==e;for(a=document.getElementsByClassName("ArrowCell"),t=0;t<a.length;t++)a[t].style.cssText=n?"display:none":"";for(a=document.getElementsByClassName("EditCell"),t=0;t<a.length;t++)if((o=a[t]).innerHTML="",n){var i=makeElement(o,"img");i.height=24,i.src="svg/deleteicon.svg",o.onclick=function(e){chats.sendApp(e,0,this.id.substring(3))}}for(a=document.getElementsByClassName("FavCell"),t=0;t<a.length;t++){var o=a[t],d="1"==o.getAttribute("data-Fav");if(o.innerHTML="",n){var m=makeElement(fav,"img");m.height=24,m.src=d?"svg/favorite.svg":"svg/notfavorite.svg"}}},this.addHelp=function(e){var t=JSON.parse(e),a=t.id;n(a);var i=document.getElementById(t.list),l=MakeHelpMessage(t.text,a);i.appendChild(l)},this.addChat=function(e,t){var a=JSON.parse(e);t=parseInt(t);var n,o,d,m,r,s,c=a.id;if(t||((s=document.getElementById(c))&&s.ImgBlank&&a.image&&"arrowgreen"==a.connecting&&(s=null,removeById(c)),s||(t=!0)),t){var v=document.getElementById(a.list);(s=makeElement(v,"li","chat")).id=c,iidLine++,s.setAttribute("data-line",iidLine),LineVisible=0,s.setAttribute("data-visible",LineVisible);var g=makeElement(s,"div","listTable"),u=makeElement(g,"div","dialogRow");makeElement(u,"div","dialogCell dialogCellMiddle EditCell","del"+c),r=makeElement(u,"div","dialogCell dialogCellMiddle","av"+c);var f=makeElement(u,"div","dialogCell dialogWide noPointer"),h=makeElement(f,"div","noftxt");o=makeElement(f,"div","noftxt","msg"+c),p=makeElement(f,"div","noftxt");var E=makeElement(u,"div","dialogCell dialogCellMiddle ArrowCell");d=makeElement(E,"div","conimg","arw"+c),"private"!=a.list&&(fav=makeElement(u,"div","dialogCell dialogCellMiddle FavCell","fav"+c),fav.pid=[c,a.image,a.name,a.desc],fav.onclick=function(e){i(e,this.pid)},fav.setAttribute("data-Fav",a.Fav));var p=makeElement(f,"div","");m=makeElement(p,"div","","stat"+c),n=ProcessName(a.name,"",65535);var C=makeElement(h,"p");C.className="chatsGroup";var k=createSmText((void 0!=a.pawn?a.pawn:"")+n.name);void 0!==n.glow&&(k.style["text-shadow"]=MakeGlow(n.glow)),void 0!==n.col&&(k.style.color="#"+toHex6(n.col)),C.appendChild(k),"<i>"!=a.image&&(s.pid=c,s.onclick=function(e){chats.sendApp(e,this.pid)},AddHammer(s,Hammer.DIRECTION_RIGHT)),LoadImage(r,a.image,"avatar",30,a),a.image||(s.ImgBlank=!0)}else document.getElementById("del"+c),r=document.getElementById("av"+c),o=document.getElementById("msg"+c),d=document.getElementById("arw"+c),fav=document.getElementById("fav"+c),m=document.getElementById("stat"+c);var y=xInt(a.GreyCnt);y>0?(r.holder.count||(r.holder.count=makeElement(r.holder,"span","count")),y>9&&(y="9+"),xInt(a.GreenCnt)<1?r.holder.count.style.backgroundColor="#404040":r.holder.count.style.backgroundColor="#00820b",r.holder.count.innerText=y):r.holder.count&&(r.holder.count.style.visibility="hidden"),o.innerHTML="",a.text&&""!=a.text||(a.text="\ufeff");var b=makeElement(o,"p");b.className="chatsMessage";var I=createSmText(a.text);b.appendChild(I),m.innerHTML="";var T=makeElement(m,"p");T.className="chatsMinsAgo";var x=GetTimeToGo(a.LastMsgTime);""!=a.at&&x.push([""," (@"+a.at+")"]),a.offline&&(x=a.offline),""==x&&(x="\ufeff"),addText(T,x),d.innerHTML="",a.connecting&&!a.edit&&(makeElement(d,"img","conimg").src="svg/"+a.connecting+".svg"),t&&"1"==l&&SetEdit(l)},this.clearChats=function(){modalClose();var e=["groups","private"];for(var t in e)for(var a=document.getElementById(e[t]),n=a.childNodes,i=0;i<n.length;i++)"0"!==n[i].id&&a.removeChild(n[i--])}};