var actions=new function(){function e(){if(!p||"Profile"==P||"Actions"==P){var e=!(90==window.orientation||-90==window.orientation);e!==h&&(h=e,"profile"==ThisPage?(C[0]=P="Profile",t()):addTitleBar(["mob1.actions","Actions"],["mob1.backback","‚ùÆ Back"],function(){actions.sendApp(event,"GoBack")},"",null),p&&actions.sendApp(event,P))}}function t(){if("profile"==ThisPage){A=config.NotLoggedIn;var e="Edit";k&&(e="Done"),A&&(e=""),"Profile"!=P&&"xatme"!=P&&(e=""),e&&(e=["mob1."+e.toLowerCase(),e]),addTitleBar(["mob1.me","Me"],A?["mob1.login","Login"]:["mob1.logout","Logout"],A?d:c,e,o),config.PhoneType==PhoneTypes.IPHONE&&a(e)}}function a(e){if("actions"!=ThisPage&&e!==N&&(N=e,""==e&&(e=0),"Done"!=e)){var t={name:"SetEditButton"+e};ToC(t)}}function o(e){if(k=1===e||0===e?0!=e:!k,"profile"==ThisPage)return"Profile"==P?void(k?doProfileDialog():modalClose()):void 0}function n(e,t){function a(e){c.length<1||(i(makeElement(e,"div",Classic?"row":"dialogRow"),c),d=0,c=[],r++)}switch(sendFunc=actions.sendApp,e){case"Divorce":case"Marry":case"Transfer":case"PrivateMessage":return void doModal(p[e]);case"doBan":case"doKick":return E=t,doModal(e),addText(document.getElementById("BanName"),t.label),addText(document.getElementById("DoIt"),t.label),Classic||s(document.getElementById("BanPic"),t),void("Boot"!=t.Type&&setTextNode("BootToRow",""))}var o=clearDiv(T),n=makeElement(o,"div",Classic?"table":"listTable");if(Classic&&(n.style.width="100%",b)){o.style.width="50%",o.style.width="50%";var l=document.getElementById("infoCell");l.style.width="50%",l.style.textAlign="center"}var r=1,d=0,c=[];I.push(e);var m;for(var g in p[e]){var u=!1;switch((m=p[e][g]).type){case"title":addEditBox(o,0,m.name,"noedit","bold");break;case"password":addEditBox(o,m.id,m.name,0,0,"password");break;case"dialog":addEditBox(o,m.id,m.name);break;case"text":var v=document.getElementById("xatsdays");addEditBox(v,0,m.name,"noedit");break;default:m.row>r&&a(n),c.push(m),++d==(Classic?2:3)&&a(n),u=!0}u||a(n)}d&&a(n)}function i(e,t){l(e,t[0],!0,!1),l(e,t[1],!1,!0),l(e,t[2])}function s(e,t){if(Classic){var a,o,n=makeElement(e,"div","butcontainer");n.style.cssText="background-color: #"+toHex6(config.ButCol);var i=makeElement(n,"div","butlayout"),s=makeElement(i,"div","butcontent");if(s.style.cssText="padding: 6px; color:#"+toHex6(config.ButColW),o=makeElement(s,"div","table"),a=makeElement(o,"div","cell"),t.Power);else{var l=makeElement(a,"img","buttonimg"),r="svg/act"+t.icon+".svg";l.src=r,l.height=30,l.width=30}var d=t.label;if(!Array.isArray(d)&&"["==d.charAt(0)){if((r=(r=d.substr(1,d.length-2)).split(",")).length<2)return;var c=[];c[0]=r.shift(),c[1]=r.join(","),d=c}return a=makeElement(o,"div","cell"),a.style.width="100%",void addText(a,d)}if(t.Power){var m=createSm(t.icon.toLowerCase(),"holder2",50);e.appendChild(m)}else{var l=makeElement(e,"img","buttonimg"),r="svg/act"+t.icon+".svg";l.src=r,l.height=50,l.width=50}}function l(e,t,a,o){if(t){var n,i=!1;if(Classic&&"OK"==t.action?((e=document.getElementById("okPos")).style.cssText="padding: 6px 25% 6px 25%;",i=!0,(n=makeElement(e,"div")).style.cssText="width:100%;"):n=makeElement(e,"div",Classic?"cell":"dialogCell"),Classic&&!i){var l=4,r=4;a&&(r=8),o&&(l=8),n.style.cssText="width:50%; padding: 4px "+l+"px 4px "+r+"px;"}else n.setAttribute("align","center");var d=t.action;if("$"==d.charAt(0)&&(d=d.substr(1)),n.id="act_"+d,n.flags=t.flags,1&t.flags&&(n.style.opacity="0.5"),n.onclick=function(e){1&n.flags||actions.sendApp(e,t)},t.divcol=n,s(n,t,a,o),!Classic){makeElement(n,"br");var c=makeElement(n,"span","buttonlabel");addText(c,t.label)}}}function r(e,t){for(var a=t.childNodes,o=0;o<a.length;o++)"TEXTAREA"!=a[o].nodeName&&"INPUT"!=a[o].nodeName||!a[o].id||(e[a[o].id]=a[o].value),r(e,a[o])}function d(e){doModal("LoginForm"),e&&(e=JSON.parse(e)).RegisterPass&&e.RegisterEmail&&(document.getElementById("lpassword").value=e.RegisterPass,document.getElementById("lusername").value=e.RegisterEmail)}function c(){doModal("LogoutOK")}function m(){ThierPowers=[];var e=p.AllPowers[0];for(var t in e)for(var a=32*t,o=0;o<32;o++)e[t]&1<<o&&(ThierPowers[a+o]=1);var n=p.PowersOflo;if(n&&(n=n[0]),n&&(n=n[0]),n)for(var i=n.split("|"),o=0;o<i.length;o++){var s=i[o].split("="),l=xInt(s[1]);0==l&&(l=1),ThierPowers[s[0]]=1+l}}function g(e){var t,a=[],o=0,n=u();(y=makeElement(n,"div")).id="ScrollContainer",y.className="xscrollContainer",y.style.top=document.getElementById("titleBar").clientHeight+document.getElementById("topSelector").clientHeight,y.style.bottom=0,y.addEventListener("scroll",onScrollEventHandler,!1);for(var i=makeElement(y,"ul"),s=0,l=0;l<9999&&(a[l]=e[l],void 0==a[l]?o++:(o=0,a[l].id=l),!(o>10));l++);a.sort(function(e,t){return e.s.localeCompare(t.s)}),t=i;var r,d=p.PowersMask;d&&(d=d[0]);for(var l in a)if(void 0!==a[l]&&(!ThierPowers||(r=ThierPowers[a[l].id]))){s++;var c=makeElement(t,"li","friend");iidLine++,c.setAttribute("data-line",iidLine),LineVisible=0,c.setAttribute("data-visible",LineVisible);var m=makeElement(c,"div","listTable"),g=makeElement(m,"div","dialogRow"),v=makeElement(g,"div","dialogCell dialogCellMiddle"),f=makeElement(g,"div","dialogCell dialogWide noPointer"),h=makeElement(g,"div","dialogCell dialogCellMiddle"),E=makeElement(g,"div","dialogCell dialogCellMiddle");if(LoadImage(v,config.https+"//xat.com/images/smw/"+a[l].s+".png","avatar",32,e),addText(f,a[l].s),addText(h,r),d){var b=a[l].id,x=makeElement(E,"img",0,"m"+b);x.height=24,d[b>>5]&1<<b%32?x.src="svg/off.svg":x.src="svg/on.svg",c.pid=b,c.onclick=function(e){actions.doFav(e,this.pid)}}}zapTimeout=setTimeout(doZap,10),0==s&&i.appendChild(MakeHelpMessage(TransText("mob2.nopowers","No powers or out of days")))}function u(){var e=clearDiv("all2");return DumpMemory(0),e}var v,f,p,h,y,E,b,x,w,T,C=["Actions","Powers"],P="Actions",B=0,I=[],k=!1,N=1,A=!1;this.main=function(t){xatMain(t),k=!1,N=null,h=null,P=C[0],e(),AddHammer(document.body,Hammer.DIRECTION_RIGHT),document.body.style.display="block",doZap(10),window.addEventListener("orientationchange",function(t){e()},!1),LoadLang({mob1:0,mob2:0}),Classic=1&config.Flags,Classic&&(document.getElementById("titleBar").style.display="none",document.getElementById("topSelector").style.display="none",x=document.getElementById("openModal"))},this.doBan=function(e){var t,a=["Duration","BootTo","Reason"];for(var o in a)(t=document.getElementById(a[o]))&&(E[a[o]]=t.value);E.action=E.Type,actions.sendApp(e,E)},this.sendApp=function(e,a,o){var i;switch(e.stopPropagation(),null!==a&&"object"==typeof a?(i=a.icon?a.action:a.Type,o=a.Power):i=a,i){case"Login":window.open("https://xat.com/login","_top");break;case"BuyXats":window.open("https://xat.com/buy","_blank");break;case"Store":window.open("https://xat.com/GetPowers","_blank");break;case"Settings":parent.classicSetDialog("settings",config.MyId);break;case"ClassicCancel":parent.classicSetDialog("profile",config.MyId);break;case"Edit":var s=["name","home","avataredit","status"],d=[["mob2.name","name"],["mob2.homepage","Home Page"],["mob2.avatar","Avatar"],["mob2.status","Status"]],c=["Your Name","https:// home page","http://avatar/picture","status message"],u=["Name","HomePage","Avatar","status"];if(w){(a={}).Command="SaveXatspace";for(var v in s)(x=document.getElementById(s[v]).textContent)==c[v]&&(x=""),x=x.replace(/[\x00-\x1F\x7F\\]/g,""),a[u[v]]=x;ToC(a),parent.classicSetDialog("profile",config.MyId);break}w=!0,(x=document.getElementById("infoCell")).style.width="100%";var f=clearDiv("buttonsRight"),h=makeElement(f,"div","table");h.style.width="100%";var y=makeElement(h,"div","row");l(y,{icon:1,action:"Edit",label:["mob2.save","Save"]}),l(y,{icon:1,action:"ClassicCancel",label:["mob1.cancel","Cancel"]}),addText(clearDiv("name"),p.user[0].name),addText(clearDiv("avataredit"),p.user[0].avatar),(x=clearDiv("avatarPosTop")).style.cssText="height: 20%;",addText(x,"‚ÄÅ");for(var v in s){addText(clearDiv("label"+s[v]),d[v]);var E=setTextBoxEditable(s[v],!0);""===E.innerHTML&&addText(E,c[v]);var b="wiki"+s[v];(E=document.getElementById(b))&&((E=makeElement(E,"a")).href="https://xat.com/"+b,E.target="_blank",addText(E,"üÜò"))}break;case"location":ToC({Command:"StartGroup",Group:o});break;case"swiperight":case"GoBack":T={Command:"GoBack"};"visitors"==config.PrevPage||"messages"==config.PrevPage?T={Command:"NOP",Next:config.PrevPage}:"visitors"!=config.PrevPage2&&"messages"!=config.PrevPage2||(T={Command:"NOP",Next:config.PrevPage2}),ToC(T);break;case"Divorce":case"Marry":case"Transfer":case"BFF":case"PrivateMessage":var x,T={name:i,UserNo:B,Power:o,Page:"actions",Command:"Action",Next:"messages"},C=["Message","Password","Xats","Days"];for(var P in C)(x=document.getElementById(C[P]))&&(T[C[P]]=x.value);ToC(T),Classic&&(modalClose(),parent.modalClose());break;case"Actions":case"Profile":SetSection(i),actions.configurePage(),k=!1,t();break;case"xatme":T={UserNo:B,Next:"xatme",Command:"Xatme",name:"Xatme"};ToC(T);break;case"Powers":SetSection(i),m(),loadJSON(config.https+"//xat.com/json/powers.php",function(e){g(e)},function(e){console.error(e)}),k=!1,t();break;case"Gifts":SetSection(i),loadJSON(config.https+"//xat.com/web_gear/chat/gifts.php?id="+B,function(e){GiftsLoaded(e)},function(e){console.error(e)}),k=!1,t();break;case"Cancel":I.pop(),n(I.pop());break;default:if("$"==i.charAt(0))n(i.substr(1),a);else{switch(r(T={name:i,UserNo:B,Power:o,Page:"actions",Command:"Action"},document.getElementById("all2")),T.name){case"Powers":case"Gifts":T.LastActionHero=a.name,T.SavedId=a.UserNo,T.Next="actions",T.Command="";break;case"PrivateChat":T.Next="messages";break;case"OK":return parent.ToC({Command:"LoadClassicDialog",Type:"",UserNo:0}),void parent.modalClose();default:T.Next="pop",T.Duration=a.Duration,T.Reason=a.Reason,T.BootTo=a.BootTo}ToC(T),Classic&&"actions"!=T.Next&&parent.modalClose()}}},this.configurePage=function(e){if(e&&(LineVisible=1,p=JSON.parse(e),config.NotLoggedIn||(AddSections(C,"actions.sendApp(event, '"),SetSection(P)),CacheHiddenDivs()),u().innerHTML=HiddenDivs.PictureAndName,p.user){var t=p.user[0];"1"==t.me&&(b=!0),B=t.id;var a=t.regname+" ("+B+")";if(Classic){var o=window.parent.document.getElementById("FrameDialogTitle");if(clearDiv(0,o),addText(o,a),o.setAttribute("onClick","window.open('https://xat.com/login?cn', '_blank')"),b){var i=o.parentNode.parentNode,s=xInt(i.style.width)+2*xInt(i.style.left);i.style.left=xInt(.05*s)+"px",i.style.width=xInt(.9*s)+"px"}}else setTextNode("regname",a);var l=ProcessName(t.name,"",t.pFlags),r=document.getElementById("name");r.innerHTML="";var d=makeElement(r,"h3"),c=createSmText(l.name.substr(0,64),"name");void 0!==l.glow&&(c.style["text-shadow"]=MakeGlow(l.glow)),void 0!==l.col&&(c.style.color="#"+toHex6(l.col)),d.appendChild(c),t.status&&addText(document.getElementById("status"),t.status.substr(0,128));var m=t.on;t.location&&(m+=" "+t.location),setTextNode("on",m),setTextNode("home",t.homepage.substr(0,80));var g=b?"avatarPosTop":"avatarPosLeft";Classic&&b?(T="buttonsRight",document.getElementById("butLeft").style.cssText="width: 50%;",document.getElementById("buttonsRight").style.cssText="width: 50%;"):(T="buttonsBot",document.getElementById("butLeft").style.cssText="width: 100%;",document.getElementById("infoCell").style.cssText="width: 100%;"),T=Classic&&b?"buttonsRight":"buttonsBot";var v=b;n("main");var f=t.avatar,h=document.getElementById(g),y=makeElement(h,"div");h.style.cssText="height: 100%; padding: 6px;",y.style.cssText="height: 100%;";var E=y.clientHeight,x=xInt((document.body.clientWidth-24)/2);E>x&&(E=x),!b&&E>160&&(E=160),(f>0||"("==f.charAt(0))&&E>160&&(E=160),h.style.cssText="padding: 6px;",y.style.cssText="height: "+E+"px; width:"+E+"px",document.getElementById("botPad").style.cssText="height: 100%;",document.getElementById("tgreen").style.height="auto",document.getElementById("tgreen").parentNode.style.height="auto";var w=makeElement(document.body,"div","profileAvatar","avatarid"),I=makeElement(w,"div","buttonimg"),k=h.offsetLeft+6;v&&(k+=(h.clientWidth-E)/2),k+="px";var N=h.offsetTop+6+"px";w.style.cssText="position: absolute; left: "+k+"; top: "+N+"; width: "+E+"; height: "+E+"; z-index: -1;",LoadImage(I,f,"buttonimg",xInt(E))}},this.updatePC=function(e){var t=["PrivateChat","PrivateMessage"],a=e?0:1;for(var o in t){var n=document.getElementById("act_"+t[o]);n&&(n.flags=268435454&n.flags|a,n.style.opacity=a?"0.5":"1")}},this.LoginCancel=function(){modalClose(),A&&doModal("LoginForm")},this.Login=function(){if(!Classic){var e=document.getElementById("openModal");e&&(e.style.visibility="hidden");var t={};return t.Page="profile",t.Command="Login",t.Username=document.getElementById("lusername").value,t.Password=document.getElementById("lpassword").value,FillInAll(t,["Username","Password"])&&ToC(t),!1}};this.Register=function(){var e={};return e.Page="profile",e.Command="Register",e.Username=document.getElementById("rusername").value,f=e.Password1=document.getElementById("rpassword1").value,v=e.Email=document.getElementById("remail").value,FillInAll(e,["Username","Password1","Email"])&&ToC(e),!1},this.forgotPass=function(e){var t=document.getElementById("lusername");t||(t=document.getElementById("lemail"));var a;if(t&&(t=t.value.toLowerCase()),e&&(a=e),e&&"{"==e.charAt(0)){var o=JSON.parse(e);if(o.html)return doModal("LoginForm"),AlertMessage(o.html,1),void(t&&(document.getElementById("lusername").value=t));a=""}doModal("ResetPassword"),a&&AlertMessage(a,1),t&&(document.getElementById("lemail").value=t)},this.ResetPassword=function(){var e={};return e.Page="profile",e.Command="ResetPassword",v=e.Email=document.getElementById("lemail").value.toLowerCase(),FillInAll(e,["Email"])&&ToC(e),!1},this.doRegisterDialog=function(e){doModal("RegisterDialog"),e&&((e=JSON.parse(e)).RegisterName&&(document.getElementById("rusername").value=e.RegisterName),e.RegisterPass&&(document.getElementById("rpassword1").value=e.RegisterPass),e.RegisterEmail&&(document.getElementById("remail").value=e.RegisterEmail))},this.LoginSetName=function(){v&&v.length>0&&(document.getElementById("lusername").value=v),f&&f.length>0&&(document.getElementById("lpassword").value=f)},this.doProfileDialog=function(){doModal("EditProfileDialog");var e=p.user[0];document.getElementById("iname").value=e.name,document.getElementById("iavatar").value=e.avatar,document.getElementById("ihomepage").value=e.homepage},this.termsOfService=function(){var e={};e.name="termsOfService",ToC(e)};this.doFav=function(e,t){var a={Page:"profile",Command:"SetPower"},o=p.PowersMask[0],n=document.getElementById("m"+t);e.stopPropagation();var i=0;n.src.search("svg/off.svg")>=0?n.src="svg/on.svg":(n.src="svg/off.svg",i=1),o[t>>5]=o[t>>5]&~(1<<t%32)|i*(1<<t%32),a.Value=i,a.Id=t,ToC(a)}};