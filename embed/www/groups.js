function main(e){xatMain(e),loadPromo(),LoadBackground(""),addTitleBar(["mob1.groups","Groups"],"",null,"üîç",SearchClick),AddSections(Sections,"configurePage(0, '"),SetSection("Favorites"),InitPage(0),document.body.style.display="block",ScrollContainer.style.top=document.getElementById("titleBar").clientHeight+document.getElementById("topSelector").clientHeight,ScrollContainer.style.bottom=0,ScrollContainer.addEventListener("scroll",myOnScrollEventHandler,!1),doZap(10),LoadLang({mob1:0,mob2:0})}function sendApp(e){var o={Group:e,Page:"groups",Command:"StartGroup",Next:"chats"};ToC(o)}function SearchClick(){Obj={Command:"GoSearch"},ToC(Obj)}function configurePage(e,o){e&&("string"==typeof e&&"["==e.charAt(0)&&(e=JSON.parse(e)),"Favorites"==o?(Favorites=e,o=void 0):Search=e);var a=document.getElementById("messages");a.innerHTML="",void 0!=o&&(CurrentSec=o),Section(a,CurrentSec),o&&SetSection(o),"Favorites"==CurrentSec&&isEmpty(FavHash)&&a.appendChild(MakeHelpMessage(TransText("mob2.addfav","To add favorite chat groups, click on the grey star next to a xat group")))}function Section(e,o){Dups={};o.toLowerCase();var a=PageDiv=makeElement(e,"div");a.setAttribute("id",o);loadPromo(),"Search"==o?(Search&&addGroups(a,999,Search),Search=0):"Favorites"==o?addGroups(a,999,Favorites):loadStuff(0)}function myOnScrollEventHandler(e){var o=ScrollContainer.scrollHeight-ScrollContainer.clientHeight-ScrollContainer.scrollTop;if(onScrollEventHandler(e),o<50){if(PagesLoaded<=PageAskedFor)return;if(PagesLoaded>=MaxPages)return;if("Favorites"==CurrentSec)return;loadStuff(PageAskedFor+1)}}function loadStuff(e){loadJSON(config.https+"//xat.com/json/lists/"+e+"_"+Language+"_"+CurrentSec.toLowerCase()+".php",function(e){addGroups(PageDiv,999,e)},function(e){console.error(e)}),PageAskedFor=PagesLoaded=e}function loadPromo(){if(stime=microtime(!0)/1e3,!(Promos&&stime<PromoTime)){PromoTime=stime+60;var e=config.https+"//xat.com/json/promo.php";loadJSON(e,function(e){gotPromos(e)},function(e){console.error(e)})}}function gotPromos(e){Promos=e;var o;for(var a in Promos)for(var r in Promos[a])(o=Promos[a][r]).g=o.n,o.n=["mob2.promoted","Promoted"],3==a.length&&"h"==a.charAt(0)&&(o.n=["mob1.help","Help"])}function addGroups(e,o,a){LineVisible=0;var r,t,i,n;a==Favorites&&(a=Favorites.slice()),(i=a[0]).l&&(MaxPages=i.l),Promos&&Empty&&(n="h"+Language,Promos[n]||(n="hn0"),Promos[n]||(n="hen"),Promos[n]&&a.unshift(Promos[n][0])),Promos&&(n=Promos[Language])&&0==i.p&&(a[0].Pro&&a.shift(),(n=n[Math.floor(Math.random()*n.length)]).Pro=1,a.unshift(n));for(var s in a)if((i=a[s]).g&&(n=i.g.toLowerCase(),!Dups[n])){Dups[n]=!0,li=makeElement(e,"li","group"),iidLine++,li.setAttribute("data-line",iidLine),LineVisible=0,li.setAttribute("data-visible",LineVisible);var l=makeElement(li,"div","listTable"),d=makeElement(l,"div","dialogRow");t=makeElement(d,"div","dialogCell dialogCellMiddle");var m=makeElement(d,"div","dialogCell dialogWide noPointer"),v=makeElement(m,"div","");r=makeElement(m,"div",""),g=makeElement(m,"div",""),fav=makeElement(d,"div","dialogCell dialogCellMiddle"),LoadImage(t,i.a,"group",32,i);var c=makeElement(v,"div","listTable"),g=makeElement(c,"div","dialogRow"),u=makeElement(g,"div","dialogCell dialogWide"),p=makeElement(g,"div","dialogCell"),f=makeElement(u,"p");if(f.className="groupsName",addText(f,i.g),i.g=i.g.replace(" ",""),i.n){var h=makeElement(p,"p");h.className="groupsNumber",addText(h,i.n)}var P=makeElement(fav,"img");P.height=24,FavHash[i.g.toLowerCase()]?P.src="svg/favorite.svg":P.src="svg/notfavorite.svg",fav.Obj=i,fav.onclick=function(e){doFav("0",this.Obj)};var S=makeElement(r,"p");if(S.className="groupsDescription",void 0!=i.d&&addText(S,i.d),li.setAttribute("onClick",'sendApp("'+i.g+'")'),0==--o)break}doZap(10),PagesLoaded++}function setFavorites(e,o){FavHash=JSON.parse(e);var a={};o&&(a=JSON.parse(o));var r;for(var t in a)FavHash[t]&&(a[t].d||FavHash[t].d||(FavHash[t].d=a[t].d));Favorites=[{p:0,l:5}];for(var t in FavHash)(r={}).g=FavHash[t].g,r.a=FavHash[t].a,r.d=FavHash[t].d,Favorites.push(r),Empty=!1;for(var t in a)FavHash[t]||((r={}).g=a[t].g,r.a=a[t].a,r.d=a[t].d,Favorites.push(r));Empty?configurePage(Favorites,"Popular"):configurePage(Favorites,"Favorites"),doZap(10)}function doFav(e,o,a){var r={ChatId:o,Page:"groups",Command:"Favourite"};r.a=a.a,r.g=a.g,r.d=a.d;var t=e.target;if(e.stopPropagation(),t.src.search("svg/notfavorite.svg")>=0){t.src="svg/favorite.svg";var i=!1,n=g.toLowerCase();for(var s in Favorites){var l=Favorites[s].g;if(l&&l.toLowerCase()==n){i=!0;break}}i||Favorites.push(r),FavHash[n]=r}else t.src="svg/notfavorite.svg",delete FavHash[g.toLowerCase()];ToC(r)}function DoSearch(){var e=document.getElementById("SearchEdit");loadJSON(config.https+"//xat.com/json/GroupSearch.php?s="+e.value,function(e){configurePage(e,"Search")},function(e){console.error(e)}),modalClose()}var Sections=["Favorites","Featured","Popular"],CurrentSec="Favorites",Favorites,FavHash,Search,ScrollContainer=document.getElementById("ScrollContainer"),Promos,PromoTime,PagesLoaded,PageAskedFor,MaxPages,PageDiv,Dups={},Empty=!0;